name: Publish image

on:
  push:
    branches: [ reboot ]

jobs:
  publish:
    name: Publish Kepler image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v3

      - uses: actions/setup-go@main
        with:
          go-version-file: go.mod
          cache: true

      - name: additional tags
        id: additional_tags
        shell: bash
        run: |
         echo "result=$(git rev-parse --short HEAD)-$(date +%Y%m%d%H%M%S),latest" >> $GITHUB_OUTPUT

      - name: Build and Publish image to external registry
        uses: ./.github/publish-image
        with:
          registry: quay.io/sustainable_computing_io
          username: ${{ secrets.BOT_NAME }}
          password: ${{ secrets.BOT_TOKEN }}
          additional_tags: ${{ steps.additional_tags.outputs.result }}

